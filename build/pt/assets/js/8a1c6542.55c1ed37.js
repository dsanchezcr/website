"use strict";(self.webpackChunkdsanchezcr=self.webpackChunkdsanchezcr||[]).push([[2466],{2424:(e,o,s)=>{s.r(o),s.d(o,{assets:()=>d,contentTitle:()=>r,default:()=>m,frontMatter:()=>t,metadata:()=>n,toc:()=>c});var a=s(5893),i=s(1151);const t={title:"Adicionando teste de carga aos fluxos de trabalho de CI/CD",description:"Aprenda mais sobre o Teste de Carga do Azure e como inclu\xed-lo em suas A\xe7\xf5es do GitHub",slug:"adding-load-testing-to-your-workflows",authors:["dsanchezcr"],tags:["Azure","Load Testing","GitHub Actions"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/LoadTesting/LoadTestingWebApp.jpg",date:"2022-12-21T18:00"},r="Adicionando teste de carga aos fluxos de trabalho de CI/CD",n={permalink:"/pt/blog/adding-load-testing-to-your-workflows",source:"@site/i18n/pt/docusaurus-plugin-content-blog/2022-12-21-LoadTesting.mdx",title:"Adicionando teste de carga aos fluxos de trabalho de CI/CD",description:"Aprenda mais sobre o Teste de Carga do Azure e como inclu\xed-lo em suas A\xe7\xf5es do GitHub",date:"2022-12-21T18:00:00.000Z",formattedDate:"21 de dezembro de 2022",tags:[{label:"Azure",permalink:"/pt/blog/tags/azure"},{label:"Load Testing",permalink:"/pt/blog/tags/load-testing"},{label:"GitHub Actions",permalink:"/pt/blog/tags/git-hub-actions"}],readingTime:4.865,hasTruncateMarker:!0,authors:[{name:"David Sanchez",url:"https://github.com/dsanchezcr",imageURL:"https://github.com/dsanchezcr.png",key:"dsanchezcr"}],frontMatter:{title:"Adicionando teste de carga aos fluxos de trabalho de CI/CD",description:"Aprenda mais sobre o Teste de Carga do Azure e como inclu\xed-lo em suas A\xe7\xf5es do GitHub",slug:"adding-load-testing-to-your-workflows",authors:["dsanchezcr"],tags:["Azure","Load Testing","GitHub Actions"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/LoadTesting/LoadTestingWebApp.jpg",date:"2022-12-21T18:00"},unlisted:!1,prevItem:{title:"Economia de custos com o Azure para seus aplicativos Web",permalink:"/pt/blog/cost-savings-with-azure"},nextItem:{title:"Aprovadas nas Certifica\xe7\xf5es de Partners do GitHub",permalink:"/pt/blog/GitHub-Certifications"}},d={authorsImageUrls:[void 0]},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Do que precisamos?",id:"do-que-precisamos",level:2},{value:"Primeiros passos",id:"primeiros-passos",level:2},{value:"O cen\xe1rio",id:"o-cen\xe1rio",level:3},{value:"O ambiente",id:"o-ambiente",level:3},{value:"O reposit\xf3rio",id:"o-reposit\xf3rio",level:3},{value:"A a\xe7\xe3o do GitHub",id:"a-a\xe7\xe3o-do-github",level:3},{value:"Os resultados",id:"os-resultados",level:3},{value:"Conclus\xf5es",id:"conclus\xf5es",level:2}];function u(e){const o={a:"a",blockquote:"blockquote",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,a.jsx)(o.p,{children:"O teste de carga \xe9 uma t\xe9cnica que se concentra em avaliar o desempenho de um aplicativo em condi\xe7\xf5es de carga normais ou esperadas. O objetivo \xe9 determinar como o aplicativo se comporta quando est\xe1 sujeito aos n\xedveis esperados de uso e tr\xe1fego. O teste de carga \xe9 frequentemente usado para verificar se um sistema pode lidar com o n\xfamero esperado de usu\xe1rios e transa\xe7\xf5es e para identificar quaisquer gargalos de desempenho ou problemas que possam afetar a experi\xeancia do usu\xe1rio."}),"\n",(0,a.jsxs)(o.p,{children:["O Microsoft Azure oferece um novo servi\xe7o (na visualiza\xe7\xe3o), chamado ",(0,a.jsx)(o.a,{href:"https://azure.microsoft.com/products/load-testing",children:"Teste de Carga do Azure"}),". Um dos principais benef\xedcios de usar esse servi\xe7o \xe9 que ele permite que voc\xea teste o desempenho do seu aplicativo em uma escala sem ter que investir em hardware e infraestrutura caros. Al\xe9m disso, ele \xe9 altamente configur\xe1vel e pode ser usado para testar aplicativos hospedados em uma variedade de plataformas, incluindo o Azure, servidores locais e provedores de nuvem de terceiros."]}),"\n",(0,a.jsx)(o.h2,{id:"do-que-precisamos",children:"Do que precisamos?"}),"\n",(0,a.jsxs)(o.p,{children:["Al\xe9m de uma Assinatura do Azure e uma conta do GitHub, precisaremos de uma ",(0,a.jsx)(o.a,{href:"https://jmeter.apache.org",children:"Apache JMeter"})," script, que normalmente consiste em uma s\xe9rie de elementos de teste, incluindo grupos de threads, samplers, ouvintes e asser\xe7\xf5es. Os grupos de threads definem o n\xfamero e o tipo de usu\xe1rios virtuais que ser\xe3o simulados, enquanto os samplers definem as a\xe7\xf5es ou solicita\xe7\xf5es espec\xedficas que ser\xe3o executadas pelos usu\xe1rios virtuais. Os ouvintes capturam os dados de desempenho gerados pelo teste, e as asser\xe7\xf5es definem os resultados esperados do teste e verificam se os resultados reais correspondem \xe0s expectativas."]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/LoadTestingScript.jmx",children:"Aqui voc\xea pode encontrar o script que eu criei como parte desta demonstra\xe7\xe3o"})}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/LoadTestingScript.jmx",children:(0,a.jsx)(o.img,{src:"/img/LoadTesting/JMeterScript.jpg",alt:"Here you can find the script I created as part of this demo"})})}),"\n",(0,a.jsx)(o.h2,{id:"primeiros-passos",children:"Primeiros passos"}),"\n",(0,a.jsx)(o.p,{children:"No exemplo a seguir, usaremos o Teste de Carga do Azure em nosso fluxo de trabalho das A\xe7\xf5es do GitHub para detectar quando nosso aplicativo Web atingiu um problema de desempenho. Vamos definir um cen\xe1rio de teste de carga com um n\xfamero e tipo espec\xedfico de usu\xe1rios virtuais que ser\xe3o simulados, bem como a dura\xe7\xe3o do teste e o tipo de carga de trabalho a ser simulada, que neste caso \xe9 apenas uma Solicita\xe7\xe3o HTTP. Al\xe9m disso, voc\xea tamb\xe9m pode usar o Visual Studio ou o Portal do Azure para criar e configurar seu cen\xe1rio de teste de carga."}),"\n",(0,a.jsx)(o.p,{children:"Uma vez definido o cen\xe1rio de teste de carga, podemos revisar os resultados e os dados de monitoramento, o que inclui m\xe9tricas como tempo de resposta, uso da CPU e tr\xe1fego de rede, bem como contadores de desempenho personalizados que podemos definir. Com esses dados, identificamos gargalos e otimizamos o desempenho do aplicativo."}),"\n",(0,a.jsx)(o.h3,{id:"o-cen\xe1rio",children:"O cen\xe1rio"}),"\n",(0,a.jsxs)(o.p,{children:["Desenvolvi um simples ",(0,a.jsx)(o.a,{href:"https://loadtestingweb.azurewebsites.net",children:"Aplicativo Web"})," criado com ASP.NET Core usando o .NET 7 que se conecta a um Azure Cosmos DB e adiciona um registro de cada visita \xe0 p\xe1gina e recupera os dados de todas as visitas."]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.a,{href:"https://loadtestingweb.azurewebsites.net",children:(0,a.jsx)(o.img,{src:"/img/LoadTesting/LoadTestingWebApp.jpg",alt:"Load Testing Sample Web App"})})}),"\n",(0,a.jsx)(o.h3,{id:"o-ambiente",children:"O ambiente"}),"\n",(0,a.jsxs)(o.p,{children:["Este aplicativo Web est\xe1 sendo executado em um Servi\xe7o de Aplicativo ",(0,a.jsx)("strong",{children:"B\xe1sico"})," e ele tem o Applications Insights para monitorar o desempenho do aplicativo. O Cosmos DB \xe9 definido com o ",(0,a.jsx)("strong",{children:"n\xedvel gratuito "}),"(1000 RU/s e 25 GB). Quero descobrir se o aplicativo em execu\xe7\xe3o nesse ambiente pode oferecer suporte a at\xe9 100 usu\xe1rios simult\xe2neos."]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{src:"/img/LoadTesting/AzurePortal.jpg",alt:"Azure Portal for Load Testing"})}),"\n",(0,a.jsx)(o.h3,{id:"o-reposit\xf3rio",children:"O reposit\xf3rio"}),"\n",(0,a.jsxs)(o.p,{children:["Voc\xea pode conferir o ",(0,a.jsx)(o.strong,{children:"Reposit\xf3rio do GitHub"})," ",(0,a.jsx)(o.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo",children:"aqui"}),". L\xe1 voc\xea pode bifurcar o reposit\xf3rio, use o ",(0,a.jsx)(o.a,{href:"https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fdsanchezcr%2FLoadTestingDemo%2Fmain%2FARM%2Ftemplate.json",children:"Modelo ARM"}),"."]}),"\n",(0,a.jsxs)(o.blockquote,{children:["\n",(0,a.jsx)(o.p,{children:"Observa\xe7\xe3o: O Microsoft Azure s\xf3 permite que voc\xea crie um recurso de Camada Gratuita do Cosmos DB por assinatura, voc\xea pode receber um erro se j\xe1 tiver uma Camada Gratuita do Cosmos DB em sua assinatura."}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["Este reposit\xf3rio tem um ",(0,a.jsx)(o.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/actions/runs/3745714572",children:"A\xe7\xe3o do GitHub"})," que Compile e Implante o aplicativo e execute o Teste de Carga no Teste de Carga do Azure."]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/actions/runs/3745714572",children:(0,a.jsx)(o.img,{src:"/img/LoadTesting/GitHubActionRun.jpg",alt:"GitHub Action Run for Load Testing"})})}),"\n",(0,a.jsx)(o.h3,{id:"a-a\xe7\xe3o-do-github",children:"A a\xe7\xe3o do GitHub"}),"\n",(0,a.jsxs)(o.p,{children:["O ",(0,a.jsx)(o.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/.github/workflows/workflow.yml",children:"fluxo de trabalho"})," consiste em tr\xeas etapas (Compila\xe7\xe3o, Implanta\xe7\xe3o e Teste de Carga) e \xe9 executado em cada push. O trabalho de teste de carga usa os seguintes arquivos na pasta raiz:"]}),"\n",(0,a.jsxs)(o.ul,{children:["\n",(0,a.jsx)(o.li,{children:(0,a.jsx)(o.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/blob/main/LoadTestingScript.jmx",children:"LoadTestingScript.jmx"})}),"\n",(0,a.jsx)(o.li,{children:(0,a.jsx)(o.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/blob/main/LoadTestingConfig.yaml",children:"LoadTestingConfig.yaml"})}),"\n"]}),"\n",(0,a.jsxs)(o.p,{children:["O logon do Azure \xe9 necess\xe1rio para se comunicar com o servi\xe7o de Teste de Carga do Azure para enviar o script JMeter e a configura\xe7\xe3o para o teste. Nesta configura\xe7\xe3o podemos definir o n\xfamero de ",(0,a.jsx)(o.a,{href:"https://learn.microsoft.com/azure/load-testing/concept-load-testing-concepts#test-engine?WT.mc_id=DT-MVP-5005361",children:"Motores"})," queremos executar o teste e os crit\xe9rios de falha, neste caso temos um tempo m\xe9dio de resposta inferior a 5 segundos e uma percentagem de erro inferior a 20%."]}),"\n",(0,a.jsx)(o.h3,{id:"os-resultados",children:"Os resultados"}),"\n",(0,a.jsxs)(o.p,{children:["Como voc\xea pode ver na imagem acima, o Teste de Carga ",(0,a.jsx)("strong",{children:"Falhou"})," Como o tempo m\xe9dio de resposta foi maior que o limite (5 segundos), podemos obter mais detalhes sobre a execu\xe7\xe3o do teste no Portal do Azure. ",(0,a.jsx)(o.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/engine1_results.csv",children:"Voc\xea pode baixar os resultados aqui"}),"."]}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{src:"/img/LoadTesting/TestResult.jpg",alt:"Test Results from Azure Load Testing"})}),"\n",(0,a.jsxs)(o.p,{children:["No Servi\xe7o de Aplicativo do Azure, podemos ver as m\xe9tricas com os tempos de resposta (superiores a 5 segundos) e o n\xfamero de solicita\xe7\xf5es com os Dados de entrada e sa\xedda de dados.\r\n",(0,a.jsx)(o.img,{src:"/img/LoadTesting/AppServiceMetrics.jpg",alt:"Azure App Service Metrics"})]}),"\n",(0,a.jsx)(o.p,{children:"Al\xe9m disso, adicionei o Application Insights para monitorar o aplicativo Web, no Portal do Azure podemos ver os problemas e falhas de desempenho."}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{src:"/img/LoadTesting/AppInsightsPerformance.jpg",alt:"Application Insights"})}),"\n",(0,a.jsx)(o.p,{children:"Na imagem acima, voc\xea pode ver de onde vieram as solicita\xe7\xf5es, neste caso, estou executando o Teste de Carga do Azure na regi\xe3o Leste dos EUA (Virg\xednia)."}),"\n",(0,a.jsx)(o.p,{children:(0,a.jsx)(o.img,{src:"/img/LoadTesting/AppInsightsFailures.jpg",alt:"App Insights Failures"})}),"\n",(0,a.jsx)(o.h2,{id:"conclus\xf5es",children:"Conclus\xf5es"}),"\n",(0,a.jsxs)(o.p,{children:["O teste de carga ",(0,a.jsx)("strong",{children:"n\xe3o deve ser"})," em execu\xe7\xe3o em um ambiente de produ\xe7\xe3o, experimente-o em um QA ou Pr\xe9-Produ\xe7\xe3o. Mesmo que voc\xea esteja executando em slots de implanta\xe7\xe3o, lembre-se de que o aplicativo ainda ser\xe1 executado no mesmo Plano de Servi\xe7o de Aplicativo, e isso pode afetar seu ambiente de produ\xe7\xe3o ou causar um ",(0,a.jsx)(o.a,{href:"https://en.wikipedia.org/wiki/Denial-of-service_attack",children:"Ataque de nega\xe7\xe3o de servi\xe7o"}),"."]}),"\n",(0,a.jsxs)(o.p,{children:["Se voc\xea quiser saber mais sobre o Teste de Carga do Azure, recomendo que voc\xea revise o ",(0,a.jsx)(o.a,{href:"https://learn.microsoft.com/azure/load-testing?WT.mc_id=DT-MVP-5005361",children:"documenta\xe7\xe3o do servi\xe7o"}),"."]})]})}function m(e={}){const{wrapper:o}={...(0,i.a)(),...e.components};return o?(0,a.jsx)(o,{...e,children:(0,a.jsx)(u,{...e})}):u(e)}},1151:(e,o,s)=>{s.d(o,{Z:()=>n,a:()=>r});var a=s(7294);const i={},t=a.createContext(i);function r(e){const o=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function n(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(t.Provider,{value:o},e.children)}}}]);