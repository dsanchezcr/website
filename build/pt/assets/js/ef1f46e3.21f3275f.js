"use strict";(self.webpackChunkdsanchezcr=self.webpackChunkdsanchezcr||[]).push([[4646],{2231:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>u,contentTitle:()=>t,default:()=>m,frontMatter:()=>i,metadata:()=>n,toc:()=>c});var r=a(5893),s=a(1151);const i={title:"Economia de custos com o Azure para seus aplicativos Web",description:"Aprenda como otimizar o que voc\xea paga no Azure por seus Aplicativos Web com PaaS",slug:"cost-savings-with-azure",authors:["dsanchezcr"],tags:["Azure","Cost Savings","Web Apps","SQL Azure"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/CostSavings/Automation.jpg",date:"2023-01-04T18:00"},t="Economia de custos com o Azure para seus aplicativos Web",n={permalink:"/pt/blog/cost-savings-with-azure",source:"@site/i18n/pt/docusaurus-plugin-content-blog/2023-01-03-CostSavingAzure.mdx",title:"Economia de custos com o Azure para seus aplicativos Web",description:"Aprenda como otimizar o que voc\xea paga no Azure por seus Aplicativos Web com PaaS",date:"2023-01-04T18:00:00.000Z",formattedDate:"4 de janeiro de 2023",tags:[{label:"Azure",permalink:"/pt/blog/tags/azure"},{label:"Cost Savings",permalink:"/pt/blog/tags/cost-savings"},{label:"Web Apps",permalink:"/pt/blog/tags/web-apps"},{label:"SQL Azure",permalink:"/pt/blog/tags/sql-azure"}],readingTime:4.33,hasTruncateMarker:!0,authors:[{name:"David Sanchez",url:"https://github.com/dsanchezcr",imageURL:"https://github.com/dsanchezcr.png",key:"dsanchezcr"}],frontMatter:{title:"Economia de custos com o Azure para seus aplicativos Web",description:"Aprenda como otimizar o que voc\xea paga no Azure por seus Aplicativos Web com PaaS",slug:"cost-savings-with-azure",authors:["dsanchezcr"],tags:["Azure","Cost Savings","Web Apps","SQL Azure"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/CostSavings/Automation.jpg",date:"2023-01-04T18:00"},unlisted:!1,prevItem:{title:"Listar reposit\xf3rios com seus tamanhos no Azure Repos",permalink:"/pt/blog/list-azure-repos-with-sizes"},nextItem:{title:"Adicionando teste de carga aos fluxos de trabalho de CI/CD",permalink:"/pt/blog/adding-load-testing-to-your-workflows"}},u={authorsImageUrls:[void 0]},c=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Solu\xe7\xe3o",id:"solu\xe7\xe3o",level:2},{value:"Aumentar ou diminuir a escala do aplicativo Web",id:"aumentar-ou-diminuir-a-escala-do-aplicativo-web",level:3},{value:"Aumentar ou diminuir a escala do SQL Azure",id:"aumentar-ou-diminuir-a-escala-do-sql-azure",level:3},{value:"Conclus\xe3o",id:"conclus\xe3o",level:2}];function d(e){const o={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,r.jsx)(o.p,{children:"Muitos dos nossos aplicativos Web hospedados no Azure s\xe3o criados sobre um servi\xe7o PaaS, como o Servi\xe7o de Aplicativo do Azure e o SQL Azure. Esses servi\xe7os geralmente s\xe3o cobrados com base na quantidade de recursos que consomem. Quanto mais recursos eles consomem, mais pagamos. No entanto, existem algumas pr\xe1ticas recomendadas que podemos seguir para reduzir a quantidade de recursos consumidos e, portanto, reduzir a quantidade de dinheiro que pagamos. Especialmente se estivermos executando um aplicativo Web que n\xe3o \xe9 usado 24 horas por dia, 7 dias por semana ou apenas usado durante o hor\xe1rio comercial no mesmo fuso hor\xe1rio."}),"\n",(0,r.jsxs)(o.p,{children:["Um dos princ\xedpios da computa\xe7\xe3o em nuvem \xe9 o ",(0,r.jsx)(o.strong,{children:"elasticidade"}),", o que significa que podemos aumentar ou diminuir os recursos que nosso aplicativo consome com base na demanda ou no cronograma. Esse \xe9 um \xf3timo recurso da nuvem, mas devemos estar cientes das implica\xe7\xf5es de custo desse recurso. Se ampliarmos nosso aplicativo para lidar com um pico de tr\xe1fego, tamb\xe9m devemos reduzir os recursos quando o tr\xe1fego voltar ao normal."]}),"\n",(0,r.jsx)(o.p,{children:"No Servi\xe7o de Aplicativo do Azure, temos duas maneiras de escalar, aumentar ou diminuir a escala e expandir para fora ou para dentro. Aumentar ou diminuir a escala significa que podemos alterar o tamanho da VM em que nosso aplicativo est\xe1 sendo executado. Expandir ou aumentar significa que podemos adicionar ou remover VMs do nosso aplicativo. Podemos aumentar ou diminuir a escala e reduzir a escala para fora ou para dentro ao mesmo tempo. Por exemplo, podemos aumentar o tamanho das VMs e adicionar mais VMs ao nosso aplicativo."}),"\n",(0,r.jsx)(o.p,{children:"Portanto, se tivermos um aplicativo Web de produ\xe7\xe3o que n\xe3o seja usado 24 horas por dia, 7 dias por semana, devemos considerar o seguinte:"}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:"Reduza o aplicativo e o banco de dados para os recursos m\xednimos necess\xe1rios fora do hor\xe1rio de pico."}),"\n",(0,r.jsxs)(o.li,{children:["Dimensione o aplicativo e o banco de dados para os recursos m\xe1ximos necess\xe1rios durante o hor\xe1rio de pico. (al\xe9m disso, devemos habilitar o dimensionamento autom\xe1tico para expandir o aplicativo e adicionar mais inst\xe2ncias quando necess\xe1rio, ",(0,r.jsx)(o.a,{href:"https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-get-started?WT.mc_id=DT-MVP-5005361&toc=%2Fazure%2Fapp-service%2Ftoc.json#create-your-first-autoscale-setting",children:"por meio das regras que voc\xea define para expandir horizontalmente ou para dentro"}),")."]}),"\n"]}),"\n",(0,r.jsx)(o.p,{children:"O processo para aumentar e diminuir a escala pode ser desativado manualmente a partir do portal, conforme mostrado na imagem."}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{src:"/img/CostSavings/AzurePortal-ScaleUp.jpg",alt:""})}),"\n",(0,r.jsx)(o.p,{children:"No entanto, esse processo pode ser tedioso e propenso a erros. Podemos automatizar o processo para aumentar e diminuir a escala do Web App e do banco de dados durante a noite e os fins de semana. Isso reduzir\xe1 a quantidade de recursos consumidos e, portanto, reduzir\xe1 a quantidade de dinheiro que pagamos."}),"\n",(0,r.jsx)(o.h2,{id:"solu\xe7\xe3o",children:"Solu\xe7\xe3o"}),"\n",(0,r.jsxs)(o.p,{children:["N\xf3s podemos usar ",(0,r.jsx)(o.a,{href:"https://learn.microsoft.com/azure/automation/overview?WT.mc_id=DT-MVP-5005361",children:"Automa\xe7\xe3o do Azure"})," para agendar um script do PowerShell para reduzir o Aplicativo Web e o Banco de Dados durante a noite e os fins de semana. Tamb\xe9m podemos agendar outro script do PowerShell para ampliar o Aplicativo Web e o Banco de Dados antes do hor\xe1rio comercial."]}),"\n",(0,r.jsxs)(o.blockquote,{children:["\n",(0,r.jsxs)(o.p,{children:["Voc\xea precisar\xe1 configurar uma identidade atribu\xedda pelo sistema \xe0 conta de automa\xe7\xe3o do Azure para se conectar aos recursos do Azure. Voc\xea pode seguir as etapas neste ",(0,r.jsx)(o.a,{href:"https://learn.microsoft.com/azure/automation/learn/powershell-runbook-managed-identity#assign-permissions-to-managed-identities?WT.mc_id=DT-MVP-5005361",children:"artigo"}),"."]}),"\n"]}),"\n",(0,r.jsx)(o.p,{children:"Vamos explorar os scripts do PowerShell que podemos usar:"}),"\n",(0,r.jsx)(o.h3,{id:"aumentar-ou-diminuir-a-escala-do-aplicativo-web",children:"Aumentar ou diminuir a escala do aplicativo Web"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-powershell",children:'$resourceGroupName = \'<Your Resource Group>\'\r\n$appServicePlanName = \'<Your App Service>\'\r\n$tier = \'<Tier you would like to scale down - For example: Basic>\'\r\ntry\r\n{\r\n    filter timestamp {"[$(Get-Date -Format G)]: $_"}\r\n    Write-Output "Script started." | timestamp\r\n    Write-Verbose "Logging in to Azure..." -Verbose\r\n    Connect-AzAccount -Identity\r\n    Write-Verbose "Login sucessful. Proceding to update service plan..." -Verbose\r\n    Set-AzAppServicePlan -ResourceGroupName $resourceGroupName -Name $appServicePlanName -tier $tier\r\n    Write-Verbose "Service plan updated. Getting information about the update..." -Verbose\r\n    $appPlanService = Get-AzAppServicePlan -ResourceGroupName $resourceGroupName -Name $appServicePlanName\r\n    Write-Output "App Service Plan name: $($appPlanService.Name)" | timestamp\r\n    Write-Output "Current App Service Plan status: $($appPlanService.Status), tier: $($appPlanService.Sku.Name)" | timestamp\r\n    Write-Output "Script finished."\r\n}\r\ncatch {\r\n    Write-Verbose "Error... \'$_.Exception\'" -Verbose\r\n    Write-Error -Message $_.Exception\r\n    throw $_.Exception\r\n}\n'})}),"\n",(0,r.jsx)(o.h3,{id:"aumentar-ou-diminuir-a-escala-do-sql-azure",children:"Aumentar ou diminuir a escala do SQL Azure"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-powershell",children:'$resourceGroupName = \'<Your Resource Group>\'\r\n$SqlServerName = \'<Your SQL Azure Server Name>\'\r\n$DatabaseName = \'<Your SQL Azure DB Name>\'\r\n$Edition = \'<Tier you would like to scale down - For example: Basic>\'\r\n$PerfLevel = \'<Tier you would like to scale down - For example: Basic>\'\r\ntry{\r\n    filter timestamp {"[$(Get-Date -Format G)]: $_"}\r\n    Write-Output "Script started." | timestamp\r\n    Write-Verbose "Logging in to Azure..." -Verbose\r\n    Connect-AzAccount -Identity  \r\n    Write-Verbose "Login sucessful. Proceding to update SQL Server plan..." -Verbose\r\n    Set-AzSqlDatabase -ResourceGroupName $resourceGroupName -DatabaseName $DatabaseName -ServerName $SqlServerName -Edition $Edition -RequestedServiceObjectiveName $PerfLevel \r\n    Write-Verbose "SQL Server plan updated. Getting information about the update..." -Verbose\r\n    $sqlServerPlan = Get-AzSqlDatabase -ResourceGroupName $resourceGroupName -DatabaseName $DatabaseName -ServerName $SqlServerName\r\n    Write-Output "SQL Server Edition: $($sqlServerPlan.Edition)" | timestamp\r\n    Write-Output "Current SQL Server Plan status: $($sqlServerPlan.Status)" | timestamp\r\n    Write-Output "Script finished."\r\n}\r\ncatch{\r\n    Write-Verbose "Error... \'$_.Exception\'" -Verbose\r\n    Write-Error -Message $_.Exception\r\n    throw $_.Exception\r\n}\n'})}),"\n",(0,r.jsx)(o.p,{children:"Depois de criar os Runbooks na Automa\xe7\xe3o do Azure, voc\xea pode criar as agendas e vincular os Runbooks \xe0s agendas."}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{src:"/img/CostSavings/Automation.jpg",alt:""})}),"\n",(0,r.jsx)(o.h2,{id:"conclus\xe3o",children:"Conclus\xe3o"}),"\n",(0,r.jsx)(o.p,{children:"Vimos como podemos usar a Automa\xe7\xe3o do Azure e o PowerShell para agendar o dimensionamento para cima ou para baixo do Aplicativo Web e do SQL Azure. Isso nos ajudar\xe1 a economizar dinheiro e tamb\xe9m a evitar o tempo de inatividade durante o hor\xe1rio comercial, adicionando os recursos que n\xe3o usamos \xe0 noite."})]})}function m(e={}){const{wrapper:o}={...(0,s.a)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},1151:(e,o,a)=>{a.d(o,{Z:()=>n,a:()=>t});var r=a(7294);const s={},i=r.createContext(s);function t(e){const o=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function n(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(i.Provider,{value:o},e.children)}}}]);