"use strict";(self.webpackChunkdsanchezcr=self.webpackChunkdsanchezcr||[]).push([[4233],{7049:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>t,metadata:()=>n,toc:()=>d});var s=r(5893),a=r(1151);const t={title:"Conexi\xf3n a SQL Azure sin secretos",description:"Neste post mostrarei como se conectar ao SQL Azure sem usar segredos, usando o Active Directory do Azure.",slug:"SQL-Azure-Without-Secrets",authors:["dsanchezcr"],tags:["SQL Azure","GitHub","Azure Active Directory"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/SQLAzureWithoutSecrets/SQLAzureWithoutSecrets.jpg",date:"2023-07-03T18:00"},i="Conectando-se ao SQL Azure sem segredos usando o Active Directory do Azure",n={permalink:"/pt/blog/SQL-Azure-Without-Secrets",source:"@site/i18n/pt/docusaurus-plugin-content-blog/2023-07-03-SQLAzureWithoutSecrets.mdx",title:"Conexi\xf3n a SQL Azure sin secretos",description:"Neste post mostrarei como se conectar ao SQL Azure sem usar segredos, usando o Active Directory do Azure.",date:"2023-07-03T18:00:00.000Z",formattedDate:"3 de julho de 2023",tags:[{label:"SQL Azure",permalink:"/pt/blog/tags/sql-azure"},{label:"GitHub",permalink:"/pt/blog/tags/git-hub"},{label:"Azure Active Directory",permalink:"/pt/blog/tags/azure-active-directory"}],readingTime:2.06,hasTruncateMarker:!0,authors:[{name:"David Sanchez",url:"https://github.com/dsanchezcr",imageURL:"https://github.com/dsanchezcr.png",key:"dsanchezcr"}],frontMatter:{title:"Conexi\xf3n a SQL Azure sin secretos",description:"Neste post mostrarei como se conectar ao SQL Azure sem usar segredos, usando o Active Directory do Azure.",slug:"SQL-Azure-Without-Secrets",authors:["dsanchezcr"],tags:["SQL Azure","GitHub","Azure Active Directory"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/SQLAzureWithoutSecrets/SQLAzureWithoutSecrets.jpg",date:"2023-07-03T18:00"},unlisted:!1,prevItem:{title:"Extending CosmicWorks with Azure Cognitive Search and Azure OpenAI",permalink:"/pt/blog/cosmicworks-azure-cognitive-search-azure-openai"},nextItem:{title:"Quantos dias os itens de trabalho foram abertos no Azure Boards",permalink:"/pt/blog/days-work-items-open"}},c={authorsImageUrls:[void 0]},d=[{value:"Introdu\xe7\xe3o",id:"introdu\xe7\xe3o",level:2},{value:"Habilitando a autentica\xe7\xe3o do Active Directory do Azure no SQL Azure",id:"habilitando-a-autentica\xe7\xe3o-do-active-directory-do-azure-no-sql-azure",level:2},{value:"Adicionando usu\xe1rios ao SQL Azure e atribuindo permiss\xf5es",id:"adicionando-usu\xe1rios-ao-sql-azure-e-atribuindo-permiss\xf5es",level:2},{value:"Conectando-se ao SQL Azure usando o Active Directory do Azure",id:"conectando-se-ao-sql-azure-usando-o-active-directory-do-azure",level:2},{value:"Conclus\xe3o",id:"conclus\xe3o",level:2},{value:"Refer\xeancias",id:"refer\xeancias",level:2}];function u(e){const o={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.p,{children:"Neste post, mostrarei como se conectar ao SQL Azure sem usar segredos, usando o Active Directory do Azure."}),"\n",(0,s.jsx)(o.h2,{id:"introdu\xe7\xe3o",children:"Introdu\xe7\xe3o"}),"\n",(0,s.jsxs)(o.p,{children:["Com o GitHub Advanced Security, voc\xea pode verificar seu c\xf3digo em busca de segredos e vulnerabilidades em sua base de c\xf3digo e hist\xf3rico do git usando ",(0,s.jsx)(o.a,{href:"https://docs.github.com/code-security/secret-scanning/about-secret-scanning",children:"Varredura secreta"})," ou at\xe9 mesmo ir um passo al\xe9m e usar ",(0,s.jsx)(o.a,{href:"https://docs.github.com/enterprise-cloud@latest/code-security/secret-scanning/protecting-pushes-with-secret-scanning",children:"Prote\xe7\xe3o contra empurr\xf5es"})," para evitar que segredos sejam enviados para o seu reposit\xf3rio. Esta \xe9 uma grande caracter\xedstica, mas n\xe3o \xe9 suficiente. Voc\xea precisa proteger seus segredos, e voc\xea precisa gir\xe1-los. Neste post, mostrarei como se conectar ao SQL Azure sem usar segredos, usando o Active Directory do Azure. Isso se aplica a usu\xe1rios, identidades gerenciadas e entidades de servi\xe7o."]}),"\n",(0,s.jsx)(o.h2,{id:"habilitando-a-autentica\xe7\xe3o-do-active-directory-do-azure-no-sql-azure",children:"Habilitando a autentica\xe7\xe3o do Active Directory do Azure no SQL Azure"}),"\n",(0,s.jsx)(o.p,{children:"Primeiro, precisamos verificar se a autentica\xe7\xe3o do Active Directory do Azure est\xe1 habilitada no SQL Azure."}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.img,{src:"/img/SQLAzureWithoutSecrets/AADEnabledSQLServer.jpg",alt:""})}),"\n",(0,s.jsx)(o.h2,{id:"adicionando-usu\xe1rios-ao-sql-azure-e-atribuindo-permiss\xf5es",children:"Adicionando usu\xe1rios ao SQL Azure e atribuindo permiss\xf5es"}),"\n",(0,s.jsxs)(o.p,{children:["Para fazer isso, precisamos nos conectar ao servidor do SQL Azure usando o SSMS e executar a consulta a seguir que cria um usu\xe1rio de uma conta do Active Directory do Azure e atribui a db_datareader fun\xe7\xe3o a ele. Voc\xea pode saber mais sobre o ",(0,s.jsx)(o.a,{href:"https://learn.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles?WT.mc_id=DT-MVP-5005361&view=sql-server-ver16#fixed-database-roles",children:"Fun\xe7\xf5es SQL aqui"}),"."]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-sql",children:"CREATE USER [<user@AAD-tenant-domain>] FROM EXTERNAL PROVIDER;\r\nALTER ROLE db_datareader ADD MEMBER [<user@AAD-tenant-domain>];\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Exemplo:\r\n",(0,s.jsx)(o.img,{src:"/img/SQLAzureWithoutSecrets/AddingUser.jpg",alt:""})]}),"\n",(0,s.jsxs)(o.blockquote,{children:["\n",(0,s.jsx)(o.p,{children:"Nota: Voc\xea pode fazer isso no n\xedvel do servidor ou no n\xedvel do banco de dados. Se voc\xea fizer isso no n\xedvel do servidor, o usu\xe1rio ter\xe1 acesso a todos os bancos de dados no servidor. Se voc\xea fizer isso no n\xedvel do banco de dados, o usu\xe1rio s\xf3 ter\xe1 acesso a esse banco de dados."}),"\n"]}),"\n",(0,s.jsx)(o.p,{children:"Como mencionado, voc\xea tamb\xe9m pode usar identidades gerenciadas e entidades de servi\xe7o. Aqui est\xe1 um exemplo de como ele se parece ao usar uma identidade gerenciada:"}),"\n",(0,s.jsx)(o.p,{children:(0,s.jsx)(o.img,{src:"/img/SQLAzureWithoutSecrets/ManagedIdentity.jpg",alt:""})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-sql",children:"CREATE USER [name-of-the-object] FROM EXTERNAL PROVIDER;\r\nALTER ROLE db_datareader ADD MEMBER [name-of-the-object];\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Exemplo:\r\n",(0,s.jsx)(o.img,{src:"/img/SQLAzureWithoutSecrets/AddingManagedIdentity.jpg",alt:""})]}),"\n",(0,s.jsx)(o.h2,{id:"conectando-se-ao-sql-azure-usando-o-active-directory-do-azure",children:"Conectando-se ao SQL Azure usando o Active Directory do Azure"}),"\n",(0,s.jsx)(o.p,{children:"Agora que temos a autentica\xe7\xe3o do Active Directory do Azure habilitada no SQL Azure e adicionamos usu\xe1rios e permiss\xf5es atribu\xeddas, podemos nos conectar ao SQL Azure usando o Azure Active Directory."}),"\n",(0,s.jsx)(o.p,{children:"A cadeia de caracteres connectiong tem esta apar\xeancia:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-csharp",children:'Server=tcp:<my-sql-server>.database.windows.net,1433;Initial Catalog=<my-database>;Authentication="Active Directory Integrated";\n'})}),"\n",(0,s.jsx)(o.h2,{id:"conclus\xe3o",children:"Conclus\xe3o"}),"\n",(0,s.jsx)(o.p,{children:"Suas conex\xf5es com o SQL Azure agora s\xe3o mais seguras e sem usar segredos usando o Active Directory do Azure."}),"\n",(0,s.jsx)(o.h2,{id:"refer\xeancias",children:"Refer\xeancias"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"https://learn.microsoft.com/azure/azure-sql/database/authentication-aad-overview?WT.mc_id=DT-MVP-5005361",children:"SQL Azure - Usando a Autentica\xe7\xe3o do Active Directory do Azure"})}),"\n"]})]})}function l(e={}){const{wrapper:o}={...(0,a.a)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}},1151:(e,o,r)=>{r.d(o,{Z:()=>n,a:()=>i});var s=r(7294);const a={},t=s.createContext(a);function i(e){const o=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function n(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:o},e.children)}}}]);