"use strict";(self.webpackChunkdsanchezcr=self.webpackChunkdsanchezcr||[]).push([[149],{9190:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>o,contentTitle:()=>n,default:()=>l,frontMatter:()=>i,metadata:()=>c,toc:()=>u});var a=t(5893),s=t(1151);const i={title:"Conexi\xf3n a SQL Azure sin secretos",description:"En este post te mostrar\xe9 c\xf3mo conectarte a SQL Azure sin usar secretos, usando Azure Active Directory.",slug:"SQL-Azure-Without-Secrets",authors:["dsanchezcr"],tags:["SQL Azure","GitHub","Azure Active Directory"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/SQLAzureWithoutSecrets/SQLAzureWithoutSecrets.jpg",date:"2023-07-03T18:00"},n="Conexi\xf3n a SQL Azure sin secretos mediante Azure Active Directory",c={permalink:"/es/blog/SQL-Azure-Without-Secrets",source:"@site/i18n/es/docusaurus-plugin-content-blog/2023-07-03-SQLAzureWithoutSecrets.mdx",title:"Conexi\xf3n a SQL Azure sin secretos",description:"En este post te mostrar\xe9 c\xf3mo conectarte a SQL Azure sin usar secretos, usando Azure Active Directory.",date:"2023-07-03T18:00:00.000Z",formattedDate:"3 de julio de 2023",tags:[{label:"SQL Azure",permalink:"/es/blog/tags/sql-azure"},{label:"GitHub",permalink:"/es/blog/tags/git-hub"},{label:"Azure Active Directory",permalink:"/es/blog/tags/azure-active-directory"}],readingTime:1.965,hasTruncateMarker:!0,authors:[{name:"David Sanchez",url:"https://github.com/dsanchezcr",imageURL:"https://github.com/dsanchezcr.png",key:"dsanchezcr"}],frontMatter:{title:"Conexi\xf3n a SQL Azure sin secretos",description:"En este post te mostrar\xe9 c\xf3mo conectarte a SQL Azure sin usar secretos, usando Azure Active Directory.",slug:"SQL-Azure-Without-Secrets",authors:["dsanchezcr"],tags:["SQL Azure","GitHub","Azure Active Directory"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/SQLAzureWithoutSecrets/SQLAzureWithoutSecrets.jpg",date:"2023-07-03T18:00"},unlisted:!1,prevItem:{title:"Extending CosmicWorks with Azure Cognitive Search and Azure OpenAI",permalink:"/es/blog/cosmicworks-azure-cognitive-search-azure-openai"},nextItem:{title:"Cu\xe1ntos d\xedas han estado abiertos los elementos de trabajo en Azure Boards",permalink:"/es/blog/days-work-items-open"}},o={authorsImageUrls:[void 0]},u=[{value:"Introducci\xf3n",id:"introducci\xf3n",level:2},{value:"Habilitaci\xf3n de la autenticaci\xf3n de Azure Active Directory en SQL Azure",id:"habilitaci\xf3n-de-la-autenticaci\xf3n-de-azure-active-directory-en-sql-azure",level:2},{value:"Agregar usuarios a SQL Azure y asignar permisos",id:"agregar-usuarios-a-sql-azure-y-asignar-permisos",level:2},{value:"Conexi\xf3n a SQL Azure mediante Azure Active Directory",id:"conexi\xf3n-a-sql-azure-mediante-azure-active-directory",level:2},{value:"Conclusi\xf3n",id:"conclusi\xf3n",level:2},{value:"Referencias",id:"referencias",level:2}];function d(e){const r={a:"a",blockquote:"blockquote",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.p,{children:"En este post te mostrar\xe9 c\xf3mo conectarte a SQL Azure sin usar secretos, usando Azure Active Directory."}),"\n",(0,a.jsx)(r.h2,{id:"introducci\xf3n",children:"Introducci\xf3n"}),"\n",(0,a.jsxs)(r.p,{children:["Con GitHub Advanced Security, puedes escanear tu c\xf3digo en busca de secretos y vulnerabilidades en tu base de c\xf3digo e historial de git usando ",(0,a.jsx)(r.a,{href:"https://docs.github.com/code-security/secret-scanning/about-secret-scanning",children:"An\xe1lisis secreto"})," o incluso ir un paso m\xe1s all\xe1 y usar ",(0,a.jsx)(r.a,{href:"https://docs.github.com/enterprise-cloud@latest/code-security/secret-scanning/protecting-pushes-with-secret-scanning",children:"Protecci\xf3n push"})," para evitar que se introduzcan secretos en su repositorio. Esta es una gran caracter\xedstica, pero no es suficiente. Necesitas proteger tus secretos, y necesitas rotarlos. En este post te mostrar\xe9 c\xf3mo conectarte a SQL Azure sin usar secretos, usando Azure Active Directory. Esto se aplica a los usuarios, las identidades administradas y las entidades de servicio."]}),"\n",(0,a.jsx)(r.h2,{id:"habilitaci\xf3n-de-la-autenticaci\xf3n-de-azure-active-directory-en-sql-azure",children:"Habilitaci\xf3n de la autenticaci\xf3n de Azure Active Directory en SQL Azure"}),"\n",(0,a.jsx)(r.p,{children:"En primer lugar, debemos asegurarnos de que la autenticaci\xf3n de Azure Active Directory est\xe9 habilitada en SQL Azure."}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{src:"/img/SQLAzureWithoutSecrets/AADEnabledSQLServer.jpg",alt:""})}),"\n",(0,a.jsx)(r.h2,{id:"agregar-usuarios-a-sql-azure-y-asignar-permisos",children:"Agregar usuarios a SQL Azure y asignar permisos"}),"\n",(0,a.jsxs)(r.p,{children:["Para ello, debemos conectarnos al servidor de SQL Azure mediante SSMS y ejecutar la siguiente consulta que crea un usuario a partir de una cuenta de Azure Active Directory y le asigna el rol db_datareader. Puede obtener m\xe1s informaci\xf3n sobre el ",(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/sql/relational-databases/security/authentication-access/database-level-roles?WT.mc_id=DT-MVP-5005361&view=sql-server-ver16#fixed-database-roles",children:"Roles SQL aqu\xed"}),"."]}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-sql",children:"CREATE USER [<user@AAD-tenant-domain>] FROM EXTERNAL PROVIDER;\r\nALTER ROLE db_datareader ADD MEMBER [<user@AAD-tenant-domain>];\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Ejemplo:\r\n",(0,a.jsx)(r.img,{src:"/img/SQLAzureWithoutSecrets/AddingUser.jpg",alt:""})]}),"\n",(0,a.jsxs)(r.blockquote,{children:["\n",(0,a.jsx)(r.p,{children:"Nota: Puede hacerlo en el nivel de servidor o en el nivel de base de datos. Si lo hace a nivel de servidor, el usuario tendr\xe1 acceso a todas las bases de datos del servidor. Si lo hace a nivel de base de datos, el usuario solo tendr\xe1 acceso a esa base de datos."}),"\n"]}),"\n",(0,a.jsx)(r.p,{children:"Como se mencion\xf3, tambi\xe9n puede usar identidades administradas y entidades de servicio. Este es un ejemplo de c\xf3mo se ve cuando se usa una identidad administrada:"}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.img,{src:"/img/SQLAzureWithoutSecrets/ManagedIdentity.jpg",alt:""})}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-sql",children:"CREATE USER [name-of-the-object] FROM EXTERNAL PROVIDER;\r\nALTER ROLE db_datareader ADD MEMBER [name-of-the-object];\n"})}),"\n",(0,a.jsxs)(r.p,{children:["Ejemplo:\r\n",(0,a.jsx)(r.img,{src:"/img/SQLAzureWithoutSecrets/AddingManagedIdentity.jpg",alt:""})]}),"\n",(0,a.jsx)(r.h2,{id:"conexi\xf3n-a-sql-azure-mediante-azure-active-directory",children:"Conexi\xf3n a SQL Azure mediante Azure Active Directory"}),"\n",(0,a.jsx)(r.p,{children:"Ahora que tenemos habilitada la autenticaci\xf3n de Azure Active Directory en SQL Azure y hemos agregado usuarios y permisos asignados, podemos conectarnos a SQL Azure mediante Azure Active Directory."}),"\n",(0,a.jsx)(r.p,{children:"La cadena connectiong tiene este aspecto:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-csharp",children:'Server=tcp:<my-sql-server>.database.windows.net,1433;Initial Catalog=<my-database>;Authentication="Active Directory Integrated";\n'})}),"\n",(0,a.jsx)(r.h2,{id:"conclusi\xf3n",children:"Conclusi\xf3n"}),"\n",(0,a.jsx)(r.p,{children:"Las conexiones a SQL Azure ahora son m\xe1s seguras y sin usar secretos mediante Azure Active Directory."}),"\n",(0,a.jsx)(r.h2,{id:"referencias",children:"Referencias"}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:(0,a.jsx)(r.a,{href:"https://learn.microsoft.com/azure/azure-sql/database/authentication-aad-overview?WT.mc_id=DT-MVP-5005361",children:"SQL Azure: uso de la autenticaci\xf3n de Azure Active Directory"})}),"\n"]})]})}function l(e={}){const{wrapper:r}={...(0,s.a)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},1151:(e,r,t)=>{t.d(r,{Z:()=>c,a:()=>n});var a=t(7294);const s={},i=a.createContext(s);function n(e){const r=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:n(e.components),a.createElement(i.Provider,{value:r},e.children)}}}]);