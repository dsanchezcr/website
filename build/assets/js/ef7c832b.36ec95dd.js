"use strict";(self.webpackChunkdsanchezcr=self.webpackChunkdsanchezcr||[]).push([[1331],{2196:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>p,frontMatter:()=>a,metadata:()=>i,toc:()=>c});var o=r(5893),n=r(1151);const a={title:"Cost Savings with Azure for your Web Apps",description:"Learn how to optimize what you pay in Azure for your Web Apps with PaaS.",slug:"cost-savings-with-azure",authors:["dsanchezcr"],tags:["Azure","Cost Savings","Web Apps","SQL Azure"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/CostSavings/Automation.jpg",date:"2023-01-04T18:00"},s="Cost Savings with Azure for your Web Apps",i={permalink:"/blog/cost-savings-with-azure",source:"@site/blog/2023-01-03-CostSavingAzure.mdx",title:"Cost Savings with Azure for your Web Apps",description:"Learn how to optimize what you pay in Azure for your Web Apps with PaaS.",date:"2023-01-04T18:00:00.000Z",formattedDate:"January 4, 2023",tags:[{label:"Azure",permalink:"/blog/tags/azure"},{label:"Cost Savings",permalink:"/blog/tags/cost-savings"},{label:"Web Apps",permalink:"/blog/tags/web-apps"},{label:"SQL Azure",permalink:"/blog/tags/sql-azure"}],readingTime:4.17,hasTruncateMarker:!0,authors:[{name:"David Sanchez",url:"https://github.com/dsanchezcr",email:"dsanchezcr@outlook.com",imageURL:"https://github.com/dsanchezcr.png",key:"dsanchezcr"}],frontMatter:{title:"Cost Savings with Azure for your Web Apps",description:"Learn how to optimize what you pay in Azure for your Web Apps with PaaS.",slug:"cost-savings-with-azure",authors:["dsanchezcr"],tags:["Azure","Cost Savings","Web Apps","SQL Azure"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/CostSavings/Automation.jpg",date:"2023-01-04T18:00"},unlisted:!1,prevItem:{title:"List repositories with their sizes in Azure Repos",permalink:"/blog/list-azure-repos-with-sizes"},nextItem:{title:"Adding Load Testing to your CI/CD workflows",permalink:"/blog/adding-load-testing-to-your-workflows"}},u={authorsImageUrls:[void 0]},c=[{value:"Introduction",id:"introduction",level:2},{value:"Solution",id:"solution",level:2},{value:"Scale Up or Down the Web App",id:"scale-up-or-down-the-web-app",level:3},{value:"Scale Up or Down the SQL Azure",id:"scale-up-or-down-the-sql-azure",level:3},{value:"Conclusion",id:"conclusion",level:2}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,o.jsx)(t.p,{children:"Many of our web app hosted on Azure are built on top of a PaaS service, such as Azure App Service and SQL Azure. These services are usually billed based on the amount of resources they consume. The more resources they consume, the more we pay. However, there are some best practices that we can follow to reduce the amount of resources consumed and, therefore, reduce the amount of money we pay. Specially if we are running a web app that is not used 24/7 or just used during business hours in the same time zone."}),"\n",(0,o.jsxs)(t.p,{children:["One of the cloud computing principles is the ",(0,o.jsx)(t.strong,{children:"elasticity"}),", meaning that we can scale up or down the resources that our app consumes based on the demand or schedule. This is a great feature of the cloud, but we should be aware of the cost implications of this feature. If we scale up our app to handle a peak of traffic, we should also scale down the resources when the traffic is back to normal."]}),"\n",(0,o.jsx)(t.p,{children:"In Azure App Service we have two ways to scale, scale up or down and scale out or in. Scale up or down means that we can change the size of the VM that our app is running on. Scale out or in means that we can add or remove VMs from our app. We can scale up or down and scale out or in at the same time. For example, we can scale up the size of the VMs and add more VMs to our app."}),"\n",(0,o.jsx)(t.p,{children:"So if we have a production Web App that is not used 24/7, we should consider the following:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Scale down the app and database to the minimum resources needed during off-peak hours."}),"\n",(0,o.jsxs)(t.li,{children:["Scale up the app and database to the maximum resources needed during peak hours. (in addition, we should enable auto-scaling to scale out the app and add more instances when needed, ",(0,o.jsx)(t.a,{href:"https://learn.microsoft.com/azure/azure-monitor/autoscale/autoscale-get-started?WT.mc_id=DT-MVP-5005361&toc=%2Fazure%2Fapp-service%2Ftoc.json#create-your-first-autoscale-setting",children:"through the rules that you define to scale out or in"}),")."]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"The process to scale up and down can be down manually from the portal as shown in the image."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:r(5858).Z+"",width:"1762",height:"871"})}),"\n",(0,o.jsx)(t.p,{children:"However, this process can be tedious and error-prone. We can automate the process to scale up and down the Web App and the database during the night and weekends. This will reduce the amount of resources consumed and, therefore, reduce the amount of money we pay."}),"\n",(0,o.jsx)(t.h2,{id:"solution",children:"Solution"}),"\n",(0,o.jsxs)(t.p,{children:["We can use ",(0,o.jsx)(t.a,{href:"https://learn.microsoft.com/azure/automation/overview?WT.mc_id=DT-MVP-5005361",children:"Azure Automation"})," service to schedule a PowerShell script to scale down the Web App and the DB during the night and weekends. We can also schedule another PowerShell script to scale up the Web App and the DB during before the business hours."]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["You will need to setup an System Assigned Identity to the Azure Automation account to connect with the Azure Resources. You can follow the steps in this ",(0,o.jsx)(t.a,{href:"https://learn.microsoft.com/azure/automation/learn/powershell-runbook-managed-identity?WT.mc_id=DT-MVP-5005361#assign-permissions-to-managed-identities",children:"article"}),"."]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:"Let's explore the PowerShell scripts that we can use:"}),"\n",(0,o.jsx)(t.h3,{id:"scale-up-or-down-the-web-app",children:"Scale Up or Down the Web App"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-powershell",children:'$resourceGroupName = \'<Your Resource Group>\'\r\n$appServicePlanName = \'<Your App Service>\'\r\n$tier = \'<Tier you would like to scale down - For example: Basic>\'\r\ntry\r\n{\r\n    filter timestamp {"[$(Get-Date -Format G)]: $_"}\r\n    Write-Output "Script started." | timestamp\r\n    Write-Verbose "Logging in to Azure..." -Verbose\r\n    Connect-AzAccount -Identity\r\n    Write-Verbose "Login sucessful. Proceding to update service plan..." -Verbose\r\n    Set-AzAppServicePlan -ResourceGroupName $resourceGroupName -Name $appServicePlanName -tier $tier\r\n    Write-Verbose "Service plan updated. Getting information about the update..." -Verbose\r\n    $appPlanService = Get-AzAppServicePlan -ResourceGroupName $resourceGroupName -Name $appServicePlanName\r\n    Write-Output "App Service Plan name: $($appPlanService.Name)" | timestamp\r\n    Write-Output "Current App Service Plan status: $($appPlanService.Status), tier: $($appPlanService.Sku.Name)" | timestamp\r\n    Write-Output "Script finished."\r\n}\r\ncatch {\r\n    Write-Verbose "Error... \'$_.Exception\'" -Verbose\r\n    Write-Error -Message $_.Exception\r\n    throw $_.Exception\r\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"scale-up-or-down-the-sql-azure",children:"Scale Up or Down the SQL Azure"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-powershell",children:'$resourceGroupName = \'<Your Resource Group>\'\r\n$SqlServerName = \'<Your SQL Azure Server Name>\'\r\n$DatabaseName = \'<Your SQL Azure DB Name>\'\r\n$Edition = \'<Tier you would like to scale down - For example: Basic>\'\r\n$PerfLevel = \'<Tier you would like to scale down - For example: Basic>\'\r\ntry{\r\n    filter timestamp {"[$(Get-Date -Format G)]: $_"}\r\n    Write-Output "Script started." | timestamp\r\n    Write-Verbose "Logging in to Azure..." -Verbose\r\n    Connect-AzAccount -Identity  \r\n    Write-Verbose "Login sucessful. Proceding to update SQL Server plan..." -Verbose\r\n    Set-AzSqlDatabase -ResourceGroupName $resourceGroupName -DatabaseName $DatabaseName -ServerName $SqlServerName -Edition $Edition -RequestedServiceObjectiveName $PerfLevel \r\n    Write-Verbose "SQL Server plan updated. Getting information about the update..." -Verbose\r\n    $sqlServerPlan = Get-AzSqlDatabase -ResourceGroupName $resourceGroupName -DatabaseName $DatabaseName -ServerName $SqlServerName\r\n    Write-Output "SQL Server Edition: $($sqlServerPlan.Edition)" | timestamp\r\n    Write-Output "Current SQL Server Plan status: $($sqlServerPlan.Status)" | timestamp\r\n    Write-Output "Script finished."\r\n}\r\ncatch{\r\n    Write-Verbose "Error... \'$_.Exception\'" -Verbose\r\n    Write-Error -Message $_.Exception\r\n    throw $_.Exception\r\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"Once you create the Runbooks in Azure Automation you can create the schedules and linke the Runbooks to the schedules."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.img,{src:r(363).Z+"",width:"926",height:"650"})}),"\n",(0,o.jsx)(t.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsx)(t.p,{children:"We have seen how we can use Azure Automation and PowerShell to schedule the scaling up or down of the Web App and the SQL Azure. This will help us to save money and also to avoid the downtime during the business hours by adding the resources we do not use at night."})]})}function p(e={}){const{wrapper:t}={...(0,n.a)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},363:(e,t,r)=>{r.d(t,{Z:()=>o});const o=r.p+"assets/images/Automation-dc1cd613360a72d3d5c2b78eabcc35b7.jpg"},5858:(e,t,r)=>{r.d(t,{Z:()=>o});const o=r.p+"assets/images/AzurePortal-ScaleUp-d4a0cb5077013d4d508c3b6c9c51357d.jpg"},1151:(e,t,r)=>{r.d(t,{Z:()=>i,a:()=>s});var o=r(7294);const n={},a=o.createContext(n);function s(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:s(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);