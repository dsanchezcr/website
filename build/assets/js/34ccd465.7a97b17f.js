"use strict";(self.webpackChunkdsanchezcr=self.webpackChunkdsanchezcr||[]).push([[6651],{7450:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>r,toc:()=>d});var i=n(5893),s=n(1151);const o={title:"Adding Load Testing to your CI/CD workflows",description:"Learn about Azure Load Testing and how to include it in your GitHub Actions.",slug:"adding-load-testing-to-your-workflows",authors:["dsanchezcr"],tags:["Azure","Load Testing","GitHub Actions"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/LoadTesting/LoadTestingWebApp.jpg",date:"2022-12-21T18:00"},a="Adding Load Testing to your CI/CD workflows",r={permalink:"/blog/adding-load-testing-to-your-workflows",source:"@site/blog/2022-12-21-LoadTesting.mdx",title:"Adding Load Testing to your CI/CD workflows",description:"Learn about Azure Load Testing and how to include it in your GitHub Actions.",date:"2022-12-21T18:00:00.000Z",formattedDate:"December 21, 2022",tags:[{label:"Azure",permalink:"/blog/tags/azure"},{label:"Load Testing",permalink:"/blog/tags/load-testing"},{label:"GitHub Actions",permalink:"/blog/tags/git-hub-actions"}],readingTime:4.63,hasTruncateMarker:!0,authors:[{name:"David Sanchez",url:"https://github.com/dsanchezcr",email:"dsanchezcr@outlook.com",imageURL:"https://github.com/dsanchezcr.png",key:"dsanchezcr"}],frontMatter:{title:"Adding Load Testing to your CI/CD workflows",description:"Learn about Azure Load Testing and how to include it in your GitHub Actions.",slug:"adding-load-testing-to-your-workflows",authors:["dsanchezcr"],tags:["Azure","Load Testing","GitHub Actions"],enableComments:!0,hide_table_of_contents:!0,image:"https://raw.githubusercontent.com/dsanchezcr/website/main/static/img/LoadTesting/LoadTestingWebApp.jpg",date:"2022-12-21T18:00"},unlisted:!1,prevItem:{title:"Cost Savings with Azure for your Web Apps",permalink:"/blog/cost-savings-with-azure"},nextItem:{title:"Webinar - From Code to Cloud in a secure way with GitHub Advanced Security",permalink:"/blog/Webinar-GHAS"}},c={authorsImageUrls:[void 0]},d=[{value:"Duplicate from Xpirit Blog Post",id:"duplicate-from-xpirit-blog-post",level:4},{value:"Introduction",id:"introduction",level:2},{value:"What do we need?",id:"what-do-we-need",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"The scenario",id:"the-scenario",level:3},{value:"The environment",id:"the-environment",level:3},{value:"The repository",id:"the-repository",level:3},{value:"The GitHub Action",id:"the-github-action",level:3},{value:"The Results",id:"the-results",level:3},{value:"Conclusions",id:"conclusions",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h4,{id:"duplicate-from-xpirit-blog-post",children:(0,i.jsx)(t.a,{href:"https://xpirit.com/adding-load-testing-to-your-workflows",children:"Duplicate from Xpirit Blog Post"})}),"\n",(0,i.jsx)(t.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(t.p,{children:"Load testing is a technique that focuses on evaluating the performance of an application under normal or expected load conditions. The goal is to determine how the application behaves when it is subjected to the expected levels of usage and traffic. Load testing is often used to verify that a system can handle the expected number of users and transactions, and to identify any performance bottlenecks or issues that may impact the user experience."}),"\n",(0,i.jsxs)(t.p,{children:["Microsoft Azure offers a new service (on preview), called ",(0,i.jsx)(t.a,{href:"https://azure.microsoft.com/products/load-testing",children:"Azure Load Testing"}),". One of the key benefits of using this service is that it allows you to test your application's performance at a scale without having to invest in expensive hardware and infrastructure. Additionally, it is highly configurable and can be used to test applications hosted on a variety of platforms, including Azure, on-premises servers, and third-party cloud providers."]}),"\n",(0,i.jsx)(t.h2,{id:"what-do-we-need",children:"What do we need?"}),"\n",(0,i.jsxs)(t.p,{children:["In addition to an Azure Subscription, and a GitHub account, we will need an ",(0,i.jsx)(t.a,{href:"https://jmeter.apache.org",children:"Apache JMeter"})," script, which typically consists of a series of test elements, including thread groups, samplers, listeners, and assertions. The thread groups define the number and type of virtual users that will be simulated, while the samplers define the specific actions or requests that will be performed by the virtual users. The listeners capture the performance data generated by the test, and the assertions define the expected results of the test and verify that the actual results match the expectations."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/LoadTestingScript.jmx",children:"Here you can find the script I created as part of this demo"})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/LoadTestingScript.jmx",children:(0,i.jsx)(t.img,{alt:"Here you can find the script I created as part of this demo",src:n(7018).Z+"",width:"1200",height:"342"})})}),"\n",(0,i.jsx)(t.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsx)(t.p,{children:"In the following example, we are going to use Azure Load Testing in our workflow from GitHub Actions to detect when our web app has reached a performance issue. We are going to define a load test scenario with a specific number and type of virtual users that will be simulated, as well as the test duration and the type of workload to be simulated, which in this case is just an HTTP Request. In addition, you can also use either Visual Studio or the Azure Portal to create and configure your load test scenario."}),"\n",(0,i.jsx)(t.p,{children:"Once the load test scenario is defined, we can review the results and monitoring data, which includes metrics such as response time, CPU usage, and network traffic, as well as custom performance counters that we can define. With this data we identify bottlenecks and optimize the application's performance."}),"\n",(0,i.jsx)(t.h3,{id:"the-scenario",children:"The scenario"}),"\n",(0,i.jsxs)(t.p,{children:["I developed a simple ",(0,i.jsx)(t.a,{href:"https://loadtestingweb.azurewebsites.net",children:"Web App"})," built with ASP.NET Core using .NET 7 that connects to an Azure Cosmos DB and adds a record of each visit to the page and retrieves the data from all the visits."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://loadtestingweb.azurewebsites.net",children:(0,i.jsx)(t.img,{alt:"Load Testing Sample Web App",src:n(514).Z+"",width:"1200",height:"436"})})}),"\n",(0,i.jsx)(t.h3,{id:"the-environment",children:"The environment"}),"\n",(0,i.jsxs)(t.p,{children:["This web app is running on an App Service ",(0,i.jsx)("strong",{children:"Basic"})," plan, and it has Applications Insights to monitor the performance of the application. The Cosmos DB is set with the ",(0,i.jsx)("strong",{children:"free tier "}),"(1000 RU/s and 25 GB). I want to find out if the application running on this environment can support up to 100 concurrent users."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Azure Portal for Load Testing",src:n(1836).Z+"",width:"1200",height:"467"})}),"\n",(0,i.jsx)(t.h3,{id:"the-repository",children:"The repository"}),"\n",(0,i.jsxs)(t.p,{children:["You can check out the ",(0,i.jsx)(t.strong,{children:"GitHub repository"})," ",(0,i.jsx)(t.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo",children:"here"}),". There you can fork the repository, use the ",(0,i.jsx)(t.a,{href:"https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Fdsanchezcr%2FLoadTestingDemo%2Fmain%2FARM%2Ftemplate.json",children:"ARM template"}),"."]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsx)(t.p,{children:"Note: Microsoft Azure only allows you to create one Cosmos DB Free Tier resource per subscription, you might get an error if you already have one Cosmos DB Free Tier in your subscription."}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["This repository has a ",(0,i.jsx)(t.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/actions/runs/3745714572",children:"GitHub Action"})," that Build & Deploy the application and run the Load Test in Azure Load Testing."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/actions/runs/3745714572",children:(0,i.jsx)(t.img,{alt:"GitHub Action Run for Load Testing",src:n(6049).Z+"",width:"1200",height:"604"})})}),"\n",(0,i.jsx)(t.h3,{id:"the-github-action",children:"The GitHub Action"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/.github/workflows/workflow.yml",children:"workflow"})," consists of three steps (Build, Deploy and Load Testing) and runs on every push. The Load Testing job uses the following files in the root folder:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/blob/main/LoadTestingScript.jmx",children:"LoadTestingScript.jmx"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/dsanchezcr/LoadTestingDemo/blob/main/LoadTestingConfig.yaml",children:"LoadTestingConfig.yaml"})}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The Azure login is required to communicate with the Azure Load Testing service to send the JMeter script and the configuration for the test. In this configuration we can define the number of ",(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/azure/load-testing/concept-load-testing-concepts#test-engine",children:"engines"})," we want to run the test and the failure criteria, in this case we have an average response time lower than 5 seconds and error percentage lower than 20%."]}),"\n",(0,i.jsx)(t.h3,{id:"the-results",children:"The Results"}),"\n",(0,i.jsxs)(t.p,{children:["As you can see in the image above, the Load Test ",(0,i.jsx)("strong",{children:"failed"})," because the average response time was higher than the threshold (5 seconds), we can get more details about the test run in the Azure Portal. ",(0,i.jsx)(t.a,{href:"https://raw.githubusercontent.com/dsanchezcr/LoadTestingDemo/main/engine1_results.csv",children:"You can download the results here"}),"."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Test Results from Azure Load Testing",src:n(2737).Z+"",width:"1200",height:"631"})}),"\n",(0,i.jsxs)(t.p,{children:["In the Azure App Service, we can see the metrics with the response times (higher than 5 seconds) and the number of requests with the Data in and Data out.\r\n",(0,i.jsx)(t.img,{alt:"Azure App Service Metrics",src:n(6433).Z+"",width:"1200",height:"631"})]}),"\n",(0,i.jsx)(t.p,{children:"In addition, I added Application Insights to monitor the web app, in the Azure Portal we can see the performance issues and failures."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Application Insights",src:n(6716).Z+"",width:"1200",height:"605"})}),"\n",(0,i.jsx)(t.p,{children:"From the image above you can see where the requests came from, in this case I am running Azure Load Testing in the East US region (Virginia)."}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"App Insights Failures",src:n(8200).Z+"",width:"1200",height:"631"})}),"\n",(0,i.jsx)(t.h2,{id:"conclusions",children:"Conclusions"}),"\n",(0,i.jsxs)(t.p,{children:["The Load Testing ",(0,i.jsx)("strong",{children:"should not be"})," running on a production environment, try it on a QA or Pre-Production. Even if you are running on deployments slots, remember that the app will still run on the same App Service Plan, and this could affect your production environment or cause a ",(0,i.jsx)(t.a,{href:"https://en.wikipedia.org/wiki/Denial-of-service_attack",children:"Denial-of-Service Attack"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["If you would like to learn more about Azure Load Testing, I recommend you review the ",(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/azure/load-testing?WT.mc_id=DT-MVP-5005361",children:"service documentation"}),"."]})]})}function l(e={}){const{wrapper:t}={...(0,s.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},8200:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/AppInsightsFailures-914593166a03d3445a4cf7c155e7c6ac.jpg"},6716:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/AppInsightsPerformance-87ca3d3f45be7d058221d55674ce4e59.jpg"},6433:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/AppServiceMetrics-db97483795a9c557d24e11f14fae2ec7.jpg"},1836:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/AzurePortal-7de9663690dcc5f2bfb1307136c00572.jpg"},6049:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/GitHubActionRun-0d4370aa7c5d326ffad3c0af1bba6e75.jpg"},7018:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/JMeterScript-3bab51df30b202aaf3ab3f73997d75b8.jpg"},514:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/LoadTestingWebApp-7bf1a136a756f219dd540db98a2deafe.jpg"},2737:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/TestResult-ae3a4e8857144dbd1a87e049715ad341.jpg"},1151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>a});var i=n(7294);const s={},o=i.createContext(s);function a(e){const t=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);